"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6292],{5937:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tarn/installation-deployment","title":"Installation & Deployment","description":"Build","source":"@site/docs/tarn/installation-deployment.md","sourceDirName":"tarn","slug":"/tarn/installation-deployment","permalink":"/tarn/installation-deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tarn/installation-deployment.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"installation-deployment","title":"Installation & Deployment","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Prerequisites & Resources","permalink":"/tarn/prerequisites-resources"},"next":{"title":"Configuration","permalink":"/tarn/configuration"}}');var t=r(4848),s=r(8453);const o={id:"installation-deployment",title:"Installation & Deployment",sidebar_position:3},a=void 0,l={},d=[{value:"Build",id:"build",level:2},{value:"Building with Enterprise Distributions (ODP by Clemlab, Cloudera...)",id:"building-with-enterprise-distributions-odp-by-clemlab-cloudera",level:3},{value:"1. Configure Repositories",id:"1-configure-repositories",level:4},{value:"2. Specify Distribution Version",id:"2-specify-distribution-version",level:4},{value:"3. Testing with Distribution Binaries",id:"3-testing-with-distribution-binaries",level:4},{value:"Deployment",id:"deployment",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"build",children:"Build"}),"\n",(0,t.jsx)(n.p,{children:"Standard build using default Maven repositories:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mvn clean package\n"})}),"\n",(0,t.jsx)(n.h3,{id:"building-with-enterprise-distributions-odp-by-clemlab-cloudera",children:"Building with Enterprise Distributions (ODP by Clemlab, Cloudera...)"}),"\n",(0,t.jsxs)(n.p,{children:["If you are using enterprise distributions like ",(0,t.jsx)(n.strong,{children:"ODP"})," (Open Source Data Platform) by ",(0,t.jsx)(n.strong,{children:"Clemlab"}),", or ",(0,t.jsx)(n.strong,{children:"Cloudera"}),", you need to configure specific Maven repositories to fetch the distribution-specific Hadoop binaries."]}),"\n",(0,t.jsx)(n.h4,{id:"1-configure-repositories",children:"1. Configure Repositories"}),"\n",(0,t.jsxs)(n.p,{children:["Add the ODP public repository to your ",(0,t.jsx)(n.code,{children:"pom.xml"})," or your ",(0,t.jsx)(n.code,{children:"~/.m2/settings.xml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<repositories>\r\n    <repository>\r\n        <id>odp-public</id>\r\n        <url>https://repo.opensourcedataplatform.com/repository/maven-public/</url>\r\n    </repository>\r\n</repositories>\n"})}),"\n",(0,t.jsx)(n.h4,{id:"2-specify-distribution-version",children:"2. Specify Distribution Version"}),"\n",(0,t.jsxs)(n.p,{children:["You should align the ",(0,t.jsx)(n.code,{children:"hadoop.version"})," with your distribution's version. You can do this by overriding the property during the build:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mvn clean package -Dhadoop.version=3.3.6.1.2.4.0-32\n"})}),"\n",(0,t.jsx)(n.h4,{id:"3-testing-with-distribution-binaries",children:"3. Testing with Distribution Binaries"}),"\n",(0,t.jsx)(n.p,{children:"To run tests using the distribution-specific dependencies:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mvn test -Dhadoop.version=3.3.6.1.2.4.0-32\n"})}),"\n",(0,t.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,t.jsx)(n.p,{children:"To submit the application to YARN:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn jar target/tarn-orchestrator-0.0.1-SNAPSHOT.jar varga.tarn.yarn.Client \\\r\n  --model-repository [model_path] \\\r\n  --image [triton_image] \\\r\n  --port [triton_port] \\\r\n  --metrics-port [metrics_port] \\\r\n  --am-port [am_port] \\\r\n  --address [bind_address] \\\r\n  --token [security_token] \\\r\n  --tp [tensor_parallelism] \\\r\n  --pp [pipeline_parallelism] \\\r\n  --secrets [hdfs_jks_path] \\\r\n  --placement-tag [tag] \\\r\n  --scale-up [threshold] \\\r\n  --scale-down [threshold] \\\r\n  --min-instances [count] \\\r\n  --max-instances [count] \\\r\n  --cooldown [ms] \\\r\n  --jar [local_jar_path] \\\r\n  --env KEY1=VALUE1 --env KEY2=VALUE2\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn jar target/tarn-orchestrator-0.0.1-SNAPSHOT.jar varga.tarn.yarn.Client \\\r\n  --model-repository hdfs:///user/models \\\r\n  --image nvcr.io/nvidia/tritonserver:24.09-py3 \\\r\n  --port 8000 \\\r\n  --metrics-port 8002 \\\r\n  --am-port 8888 \\\r\n  --address 0.0.0.0 \\\r\n  --token my-secret-token \\\r\n  --tp 2 \\\r\n  --pp 1 \\\r\n  --secrets hdfs:///user/secrets/hf.jceks \\\r\n  --placement-tag nvidia \\\r\n  --scale-up 0.8 \\\r\n  --scale-down 0.2 \\\r\n  --min-instances 2 \\\r\n  --max-instances 8 \\\r\n  --cooldown 120000 \\\r\n  --jar target/tarn-orchestrator-0.0.1-SNAPSHOT.jar \\\r\n  --env TRITON_LOG_VERBOSE=1\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);