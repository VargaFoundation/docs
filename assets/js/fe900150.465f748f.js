"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5941],{8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}},8592:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"tarn/security","title":"Security","description":"TARN implements several security features:","source":"@site/docs/tarn/security.md","sourceDirName":"tarn","slug":"/tarn/security","permalink":"/tarn/security","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tarn/security.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"security","title":"Security","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Operations","permalink":"/tarn/operations"},"next":{"title":"Troubleshooting","permalink":"/tarn/troubleshooting"}}');var s=r(4848),t=r(8453);const a={id:"security",title:"Security",sidebar_position:6},o=void 0,l={},c=[{value:"Apache Ranger Integration",id:"apache-ranger-integration",level:2},{value:"1. Create Ranger Service Definition",id:"1-create-ranger-service-definition",level:3},{value:"2. Enable Ranger in TARN",id:"2-enable-ranger-in-tarn",level:3},{value:"3. Ranger Service Definition Details",id:"3-ranger-service-definition-details",level:3},{value:"4. How it Works",id:"4-how-it-works",level:3},{value:"5. Authorization API",id:"5-authorization-api",level:3},{value:"6. Audit Configuration",id:"6-audit-configuration",level:3},{value:"7. Knox Authorization Integration",id:"7-knox-authorization-integration",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"TARN implements several security features:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"API Token"}),": The Application Master can be configured with a token to secure the service discovery endpoint."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dynamic Discovery"}),": Eliminates the need to hardcode IP addresses, reducing exposure."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YARN Isolation"}),": Leverages YARN's multi-tenancy and Docker isolation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Apache Ranger"}),": Provides centralized model-level authorization, ensuring that users can only discover and use models they are explicitly permitted to access."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Kerberos Support"}),": Compatible with secured Hadoop clusters (ensure the discovery script has a valid ticket)."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"apache-ranger-integration",children:"Apache Ranger Integration"}),"\n",(0,s.jsxs)(n.p,{children:["TARN integrates with ",(0,s.jsx)(n.strong,{children:"Apache Ranger"})," to provide fine-grained access control at the model level. This ensures that users only see and interact with the models they are authorized to use."]}),"\n",(0,s.jsx)(n.h3,{id:"1-create-ranger-service-definition",children:"1. Create Ranger Service Definition"}),"\n",(0,s.jsxs)(n.p,{children:["Before you can define policies, you must register the ",(0,s.jsx)(n.code,{children:"triton"})," service definition in Ranger Admin."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Use the following JSON to create a file named ",(0,s.jsx)(n.code,{children:"triton-service-def.json"}),":","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "name": "triton",\r\n  "id": 1001,\r\n  "resources": [\r\n    {\r\n      "name": "model",\r\n      "level": 1,\r\n      "parent": "",\r\n      "mandatory": true,\r\n      "lookupSupported": true,\r\n      "recursiveSupported": false,\r\n      "matcher": "org.apache.ranger.plugin.resourcematcher.RangerDefaultResourceMatcher",\r\n      "matcherOptions": { "wildCard": true, "ignoreCase": true },\r\n      "label": "Triton Model",\r\n      "description": "Triton Model Name"\r\n    }\r\n  ],\r\n  "accessTypes": [\r\n    { "name": "infer", "label": "Inference" },\r\n    { "name": "metadata", "label": "Metadata" },\r\n    { "name": "list", "label": "List" }\r\n  ],\r\n  "contextEnrichers": [],\r\n  "policyConditions": []\r\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Register the service type using the Ranger REST API:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -u admin:password -X POST -H "Content-Type: application/json" \\\r\n  http://<RANGER_ADMIN_HOST>:6080/service/plugins/definitions \\\r\n  -d @triton-service-def.json\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["In the Ranger Admin UI, create a new service instance (e.g., named ",(0,s.jsx)(n.code,{children:"triton_prod"}),") using the newly created ",(0,s.jsx)(n.code,{children:"triton"})," service type."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-enable-ranger-in-tarn",children:"2. Enable Ranger in TARN"}),"\n",(0,s.jsx)(n.p,{children:"To enable Ranger, you must provide the Ranger service name when submitting the application:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn jar tarn-orchestrator.jar varga.tarn.yarn.Client \\\r\n  ... \\\r\n  --ranger-service triton_prod \\\r\n  --ranger-app-id tarn \\\r\n  --ranger-audit\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Options:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--ranger-service"})," (",(0,s.jsx)(n.code,{children:"-rs"}),"): The name of the service instance defined in Ranger Admin."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--ranger-app-id"})," (",(0,s.jsx)(n.code,{children:"-ra"}),"): The application ID for Ranger (default: ",(0,s.jsx)(n.code,{children:"tarn"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--ranger-audit"})," (",(0,s.jsx)(n.code,{children:"-raudit"}),"): Enable auditing of access requests in Ranger."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Environment Variables:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RANGER_SERVICE"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RANGER_APP_ID"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RANGER_AUDIT"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-ranger-service-definition-details",children:"3. Ranger Service Definition Details"}),"\n",(0,s.jsx)(n.p,{children:"The service definition (registered in step 1) includes the following resources and access types:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resource"}),": ",(0,s.jsx)(n.code,{children:"model"})," (The name of the inference model)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Access Types"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"infer"}),": Permission to run inference requests."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"metadata"}),": Permission to view model configuration/metadata."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"list"}),": Permission to see the model in the discovery list and dashboard."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["A complete JSON service definition is available in ",(0,s.jsx)(n.code,{children:"SPEC Ranger.md"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"4-how-it-works",children:"4. How it Works"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Identity Propagation"}),": When accessing the AM Dashboard or API, TARN identifies the user via Kerberos or the ",(0,s.jsx)(n.code,{children:"X-TARN-User"})," header."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorization and Auditing"}),": For every model available in the HDFS repository, TARN queries the Ranger plugin to check if the user has ",(0,s.jsx)(n.code,{children:"list"})," permission. If ",(0,s.jsx)(n.code,{children:"--ranger-audit"})," is enabled, these access attempts are logged to the configured Ranger audit destination."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dynamic Filtering"}),": Models for which the user does not have permission are automatically filtered out from the Dashboard and service discovery results.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"list"})," permission is required to see models in the HDFS list."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"metadata"})," permission is required to see details of loaded models."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-authorization-api",children:"5. Authorization API"}),"\n",(0,s.jsx)(n.p,{children:"TARN provides a REST API to check model-level permissions. This can be used by external gateways (like Apache Knox) to enforce security for inference requests."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"}),": ",(0,s.jsx)(n.code,{children:"http://<AM_HOST>:<AM_PORT>/authorize?model=<name>&action=<action>"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Query Parameters"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"model"}),": The model name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"action"}),": The access type (",(0,s.jsx)(n.code,{children:"infer"}),", ",(0,s.jsx)(n.code,{children:"metadata"}),", or ",(0,s.jsx)(n.code,{children:"list"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user"}),": (Optional) The user to check (defaults to the requester)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response"}),": ",(0,s.jsx)(n.code,{children:"true"})," or ",(0,s.jsx)(n.code,{children:"false"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -H "X-TARN-Token: my-token" \\\r\n  "http://am-host:8888/authorize?model=resnet50&action=infer&user=alice"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"6-audit-configuration",children:"6. Audit Configuration"}),"\n",(0,s.jsx)(n.p,{children:"To enable auditing, the following conditions must be met:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"--ranger-audit"})," flag must be set."]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.code,{children:"ranger-triton-audit.xml"})," configuration file must be present in the Application Master's classpath. This file defines where the audits are sent (e.g., Solr, HDFS, or Log4j)."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Example ",(0,s.jsx)(n.code,{children:"ranger-triton-audit.xml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<configuration>\r\n    <property>\r\n        <name>xasecure.audit.is.enabled</name>\r\n        <value>true</value>\r\n    </property>\r\n    <property>\r\n        <name>xasecure.audit.destination.log4j</name>\r\n        <value>true</value>\r\n    </property>\r\n    <property>\r\n        <name>xasecure.audit.destination.log4j.logger</name>\r\n        <value>ranger.audit</value>\r\n    </property>\r\n</configuration>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"7-knox-authorization-integration",children:"7. Knox Authorization Integration"}),"\n",(0,s.jsxs)(n.p,{children:["Apache Knox can be configured to act as a ",(0,s.jsx)(n.strong,{children:"Policy Enforcement Point (PEP)"})," by leveraging the TARN Authorization API or by using the Ranger Knox Plugin."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using the Authorization API in Knox:"})}),"\n",(0,s.jsx)(n.p,{children:"To integrate Knox with the TARN Authorization API, you can use a custom Rewrite Rule or a specialized Dispatcher."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service Definition"}),": Define a Knox service for Triton."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorization Check"}),": Configure a Rewrite Rule to perform an out-of-band check or use a custom Knox Dispatcher that calls the TARN AM ",(0,s.jsx)(n.code,{children:"/authorize"})," endpoint."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example Knox Rewrite Rule for Authorization (pseudo-config):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<rules>\r\n    <rule dir="IN" name="TRITON/authorize-check" pattern="*://*:*/**/v2/models/{model}/{action}">\r\n        <rewrite template="http://am-host:8888/authorize?model={model}&amp;action={action}&amp;user={$username}"/>\r\n    </rule>\r\n</rules>\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Propagation"}),": Knox should propagate the original user identity using the ",(0,s.jsx)(n.code,{children:"X-TARN-User"})," header when talking to the AM for authorization checks."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Using the Ranger Knox Plugin:"}),"\r\nAlternatively, you can install the ",(0,s.jsx)(n.code,{children:"ranger-knox-plugin"})," on your Knox gateway and configure it to use the ",(0,s.jsx)(n.code,{children:"triton"})," service definition. This allows Knox to check policies directly against the Ranger Admin server, providing the same level of security as the TARN Application Master but at the edge of the cluster."]}),"\n",(0,s.jsx)(n.p,{children:"Example Knox Topology with Ranger Authorization:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<topology>\r\n    <gateway>\r\n        <provider>\r\n            <role>authentication</role>\r\n            <name>ShiroProvider</name>\r\n            <enabled>true</enabled>\r\n            <param>\r\n                <name>main.ldapRealm</name>\r\n                <value>org.apache.knox.gateway.shirorealm.KnoxLdapRealm</value>\r\n            </param>\r\n            <param>\r\n                <name>main.ldapRealm.userDnTemplate</name>\r\n                <value>uid={0},ou=people,dc=hadoop,dc=apache,dc=org</value>\r\n            </param>\r\n            <param>\r\n                <name>main.ldapRealm.contextFactory.url</name>\r\n                <value>ldap://localhost:33389</value>\r\n            </param>\r\n        </provider>\r\n        <provider>\r\n            <role>authorization</role>\r\n            <name>XASecurePDPKnox</name>\r\n            <enabled>true</enabled>\r\n        </provider>\r\n    </gateway>\r\n    <service>\r\n        <role>TRITON</role>\r\n        <url>http://haproxy-host:8000</url>\r\n    </service>\r\n</topology>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can include the directory containing this file in the ",(0,s.jsx)(n.code,{children:"CLASSPATH"})," or use the ",(0,s.jsx)(n.code,{children:"--env"})," option to pass configuration properties if supported by the Ranger version."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);