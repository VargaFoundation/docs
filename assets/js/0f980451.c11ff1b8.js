"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6960],{949:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tarn/configuration","title":"Configuration","description":"Model Repository Storage","source":"@site/docs/tarn/configuration.md","sourceDirName":"tarn","slug":"/tarn/configuration","permalink":"/tarn/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tarn/configuration.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"configuration","title":"Configuration","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Installation & Deployment","permalink":"/tarn/installation-deployment"},"next":{"title":"Operations","permalink":"/tarn/operations"}}');var r=o(4848),t=o(8453);const i={id:"configuration",title:"Configuration",sidebar_position:4},l=void 0,a={},d=[{value:"Model Repository Storage",id:"model-repository-storage",level:2},{value:"1. HDFS (Copy to Local)",id:"1-hdfs-copy-to-local",level:3},{value:"2. NFS (Direct Access - Recommended)",id:"2-nfs-direct-access---recommended",level:3},{value:"How to install HDFS NFS Gateway",id:"how-to-install-hdfs-nfs-gateway",level:4},{value:"Command Line Options",id:"command-line-options",level:2},{value:"Secret Management",id:"secret-management",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"model-repository-storage",children:"Model Repository Storage"}),"\n",(0,r.jsx)(n.p,{children:"TARN supports two ways to provide the model repository to Triton:"}),"\n",(0,r.jsx)(n.h3,{id:"1-hdfs-copy-to-local",children:"1. HDFS (Copy to Local)"}),"\n",(0,r.jsxs)(n.p,{children:["If your model repository path starts with ",(0,r.jsx)(n.code,{children:"hdfs:///"}),", TARN will automatically copy the models from HDFS to a local directory (",(0,r.jsx)(n.code,{children:"/models"}),") inside the container before starting Triton."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pros"}),": Easy to set up, no extra configuration on nodes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cons"}),": High latency on startup for large models, consumes local disk space."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-nfs-direct-access---recommended",children:"2. NFS (Direct Access - Recommended)"}),"\n",(0,r.jsxs)(n.p,{children:["If your path starts with ",(0,r.jsx)(n.code,{children:"/"}),", TARN will use the path directly. This is the recommended method for performance, as it avoids data copying. However, it requires an ",(0,r.jsx)(n.strong,{children:"NFS Gateway"})," to be installed and mounted on all NodeManagers."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pros"}),": Instant startup, no data duplication."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cons"}),": Requires NFS infrastructure."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"how-to-install-hdfs-nfs-gateway",children:"How to install HDFS NFS Gateway"}),"\n",(0,r.jsx)(n.p,{children:"To use the NFS method, you must deploy an HDFS NFS Gateway on your DataNodes and mount it locally."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configure HDFS for NFS"}),":\r\nAdd the following to ",(0,r.jsx)(n.code,{children:"core-site.xml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<property>\r\n  <name>hadoop.proxyuser.hdfs.groups</name>\r\n  <value>*</value>\r\n</property>\r\n<property>\r\n  <name>hadoop.proxyuser.hdfs.hosts</name>\r\n  <value>*</value>\r\n</property>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Start the NFS Gateway"}),":\r\nOn each DataNode (or dedicated nodes):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Start portmap (requires root)\r\nhdfs portmap\r\n# Start nfs3\r\nhdfs nfs3\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Mount HDFS via NFS"}),":\r\nOn all NodeManagers:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p /mnt/hdfs\r\nmount -t nfs -o vers=3,proto=tcp,nolock,noacl <NFS_GATEWAY_HOST>:/ /mnt/hdfs\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Now you can point TARN to your models using the local mount path:\r\n",(0,r.jsx)(n.code,{children:"--model-repository /mnt/hdfs/user/models/my-model"})]}),"\n",(0,r.jsx)(n.h2,{id:"command-line-options",children:"Command Line Options"}),"\n",(0,r.jsxs)(n.p,{children:["Refer to the ",(0,r.jsx)(n.a,{href:"/tarn/installation-deployment",children:"deployment example"})," for the full command. Key options include:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--model-repository"}),": Path to Triton model repository (hdfs:/// or /)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--image"}),": Docker image for Triton (e.g., nvcr.io/nvidia/tritonserver:24.09-py3)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--port"}),": Triton HTTP port (default 8000)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--metrics-port"}),": Triton metrics port (default 8002)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--am-port"}),": Application Master web port (default 8888)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--address"}),": Bind address (default 0.0.0.0)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--token"}),": Security token for AM API"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--tp"}),", ",(0,r.jsx)(n.code,{children:"--pp"}),": Tensor/Pipeline parallelism"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--secrets"}),": HDFS path to JKS/JCEKS secrets file"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--placement-tag"}),": YARN placement tag for anti-affinity"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--scale-up"}),", ",(0,r.jsx)(n.code,{children:"--scale-down"}),": Scaling thresholds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--min-instances"}),", ",(0,r.jsx)(n.code,{children:"--max-instances"}),": Instance limits"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--cooldown"}),": Scaling cooldown (ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--env KEY=VALUE"}),": Pass env vars to containers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--ranger-service"}),": Ranger service name (for authorization)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--zk-ensemble"}),", ",(0,r.jsx)(n.code,{children:"--zk-path"}),": ZooKeeper config for Knox discovery"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"secret-management",children:"Secret Management"}),"\n",(0,r.jsx)(n.p,{children:"TARN supports secret management via JKS/JCEKS files on HDFS:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"huggingface.token"})," alias is automatically mapped to ",(0,r.jsx)(n.code,{children:"HUGGING_FACE_HUB_TOKEN"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Any alias starting with ",(0,r.jsx)(n.code,{children:"tarn.env."})," is automatically mapped to an environment variable (e.g., ",(0,r.jsx)(n.code,{children:"tarn.env.AWS_SECRET_KEY"})," becomes ",(0,r.jsx)(n.code,{children:"AWS_SECRET_KEY"}),")."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>l});var s=o(6540);const r={},t=s.createContext(r);function i(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);